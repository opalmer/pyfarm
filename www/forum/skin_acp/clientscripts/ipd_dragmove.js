var drag_move=new dragmove();function dragmove(){this.var_drag_handle_id_text=null;this.var_bounce_url=null;this.var_drag_draggable_id_text=null;this.var_drag_object_id_text=null;this.var_original_row_text=null;this.current_id=null;this._drag_in_progress=null;this.var_target_ids=new Array();this.var_parent_ids=new Array();this.var_parent_process=1;this.var_hide_row_classname='dragmove-hide';this.var_target_over_classname='tablerow3';this.var_target_out_classname='tablerow2';this.var_target_over_id=null;this.var_ajax_url=null;this._TARGETS=new Array();this.dims=new Array();this.UNMOVEABLES=new Array();this.UNMOVEABLES_id='dragmove-unmoveable';this.parent_id_tree=new Array();this.child_id_tree=new Array();this.child_id_array=new Array();};dragmove.prototype.drag_init=function(){var draghandles=document.getElementsByTagName('*');for(var i=0;i<=draghandles.length;i++){try{if(!draghandles[i].id){continue;}}catch(e){continue;}var linkid=draghandles[i].id;var linkname=linkid.replace( /^(.*)-(\d+)$/,"$1");var thisid=this.get_id_from_text(draghandles[i].id);if(linkname==this.var_drag_handle_id_text){var drag_main_obj=document.getElementById(this.var_drag_draggable_id_text+'-'+thisid);var drag_handle_obj=document.getElementById(this.var_drag_handle_id_text+'-'+thisid);draghandles[i].style.cursor="move";Drag.init(drag_handle_obj,drag_main_obj);drag_main_obj.onDrag=function(x,y,e){dragmove_events.prototype.event_drag_ging(x,y,e);};drag_main_obj.onDragStart=function(x,y,e){dragmove_events.prototype.event_drag_start(x,y,e);};drag_main_obj.onDragEnd=function(x,y,e){dragmove_events.prototype.event_drag_end(x,y,e);};drag_handle_obj.onmouseover=dragmove_events.prototype.event_mouseover;drag_handle_obj.onmouseout=dragmove_events.prototype.event_mouseout;}}if(this.var_parent_ids.length){for(var i in this.var_parent_ids){if(!this.child_id_array[this.var_parent_ids[i]]){this.child_id_array[this.var_parent_ids[i]]=new Array();}this.child_id_array[this.var_parent_ids[i]][this.child_id_array[this.var_parent_ids[i]].length]=i;}}};dragmove.prototype.get_parents_array=function(root_tid){if(this.var_parent_ids[root_tid]){this.parent_id_tree[this.parent_id_tree.length]=this.var_parent_ids[root_tid];this.get_parents_array(this.var_parent_ids[root_tid]);}};dragmove.prototype.get_children_array=function(root_tid){if(this.child_id_array[root_tid]){for(var i in this.child_id_array[root_tid]){this.child_id_tree[this.child_id_tree.length]=this.child_id_array[root_tid][i];this.get_children_array(this.child_id_array[root_tid][i]);}}};dragmove.prototype.add_id_to_unmoveables=function(tid){this.UNMOVEABLES[tid]=tid;};dragmove.prototype.add_id_to_targets=function(tid){this.var_target_ids[tid]=1;};dragmove.prototype.add_id_to_parents=function(tid,parent_id){this.var_parent_ids[tid]=parent_id=='root'?0:parseInt(parent_id);};dragmove.prototype.get_id_from_text=function(id){return id.replace( /.*\-(\d+)/,"$1");};function dragmove_events(){};dragmove_events.prototype.event_TARGET_mouseover=function(e){if(drag_move.var_target_over_id){return false;}if(!drag_move._drag_in_progress){return false;}drag_move.var_target_over_id=drag_move.get_id_from_text(this.id);if(drag_move.var_parent_process&&drag_move.current_id){if(drag_move.var_target_over_id==drag_move.current_id){drag_move.var_target_over_id=null;return false;}if(drag_move.var_target_over_id==drag_move.var_parent_ids[drag_move.current_id]){drag_move.var_target_over_id=null;return false;}drag_move.child_id_tree=new Array();drag_move.get_children_array(drag_move.current_id);drag_move.child_id_tree[drag_move.child_id_tree.length]=drag_move.current_id;for(var i in drag_move.child_id_tree){if(drag_move.var_target_over_id==drag_move.child_id_tree[i]){drag_move.var_target_over_id=null;return false;}}}var target_obj=document.getElementById(drag_move.var_original_row_text+'-'+drag_move.var_target_over_id);drag_move.var_target_out_classname=target_obj.className;target_obj.className=drag_move.var_target_over_classname;};dragmove_events.prototype.event_TARGET_mouseout=function(e){if(!drag_move.var_target_over_id){return false;}if(!drag_move._drag_in_progress){return false;}var target_obj=document.getElementById(drag_move.var_original_row_text+'-'+drag_move.var_target_over_id);target_obj.className=drag_move.var_target_out_classname;drag_move.var_target_over_id=null;};dragmove_events.prototype.event_mouseover=function(e){if(drag_move.current_id){return false;}var check_for_id=drag_move.UNMOVEABLES[drag_move.get_id_from_text(this.id)];if(check_for_id){var alert_object=null;try{alert_object=document.getElementById(drag_move.UNMOVEABLES_id);}catch(error){drag_move.UNMOVEABLES_id=null;}if(alert_object){var drag_root_obj=document.getElementById(drag_move.var_drag_handle_id_text+'-'+check_for_id);alert_object.style.top=ipsclass.get_obj_toppos(drag_root_obj)-4+'px';alert_object.style.left=ipsclass.get_obj_leftpos(drag_root_obj)+22+'px';alert_object.style.position='absolute';alert_object.style.display='';}return false;}drag_move.current_id=drag_move.get_id_from_text(this.id);};dragmove_events.prototype.event_mouseout=function(e){var check_for_id=drag_move.UNMOVEABLES[drag_move.get_id_from_text(this.id)];if(check_for_id){var alert_object=null;try{alert_object=document.getElementById(drag_move.UNMOVEABLES_id);}catch(error){drag_move.UNMOVEABLES_id=null;}if(alert_object){alert_object.style.display='none';}return false;}if(!drag_move._drag_in_progress){drag_move.current_id=null;}};dragmove_events.prototype.event_drag_ging=function(x,y){if(is_ie){var bingo=0;if(drag_move.var_target_ids.length){for(var i in drag_move.var_target_ids){if(x>=drag_move.dims[i]['x1']&&x<=drag_move.dims[i]['x2']&&y>=drag_move.dims[i]['y1']&&y<=drag_move.dims[i]['y2']){bingo=1;this.id=i;dragmove_events.prototype.event_TARGET_mouseover();break;}}}if(!bingo){dragmove_events.prototype.event_TARGET_mouseout();}}};dragmove_events.prototype.event_drag_start=function(x,y){if(drag_move.current_id){var drag_main_obj=document.getElementById(drag_move.var_drag_draggable_id_text+'-'+drag_move.current_id);var drag_root_obj=document.getElementById(drag_move.var_drag_object_id_text+'-'+drag_move.current_id);var drag_orig_obj=document.getElementById(drag_move.var_original_row_text+'-'+drag_move.current_id);if(is_safari){drag_root_obj.style.position='relative';}drag_main_obj.style.top=ipsclass.get_obj_toppos(drag_root_obj)+'px';drag_main_obj.style.left=ipsclass.get_obj_leftpos(drag_root_obj)+'px';drag_main_obj.style.position='absolute';drag_main_obj.style.display='block';drag_main_obj.style.zIndex=1000;if(drag_move.var_target_ids.length){for(var i in drag_move.var_target_ids){var main_obj=document.getElementById(drag_move.var_original_row_text+'-'+i);if(is_safari){main_obj.style.position='relative';}if(is_ie){drag_move.dims[i]=new Array();drag_move.dims[i]['x1']=ipsclass.get_obj_leftpos(main_obj);drag_move.dims[i]['x2']=drag_move.dims[i]['x1']+main_obj.offsetWidth;drag_move.dims[i]['y1']=ipsclass.get_obj_toppos(main_obj)-20;drag_move.dims[i]['y2']=drag_move.dims[i]['y1']+main_obj.offsetHeight-5;}else{var targetobj=document.createElement('div');targetobj.id=drag_move.var_original_row_text+'-TARGET-'+i;targetobj.style.background='transparent';targetobj.style.position='absolute';targetobj.style.left=ipsclass.get_obj_leftpos(main_obj)+'px';targetobj.style.top=ipsclass.get_obj_toppos(main_obj)+'px';targetobj.style.width=main_obj.offsetWidth+'px';targetobj.style.height=main_obj.offsetHeight+'px';targetobj.style.zIndex=1000;document.body.appendChild(targetobj);drag_move._TARGETS[drag_move._TARGETS.length]=targetobj;targetobj.onmouseover=dragmove_events.prototype.event_TARGET_mouseover;targetobj.onmouseout=dragmove_events.prototype.event_TARGET_mouseout;}}}if(!document.getElementById(drag_move.var_original_row_text+'-HIDDEN-'+drag_move.current_id)){var newdiv=document.createElement('DIV');newdiv.id=drag_move.var_original_row_text+'-HIDDEN-'+drag_move.current_id;newdiv.className=(is_ie)?drag_move.var_hide_row_classname+'-ie':drag_move.var_hide_row_classname+'-moz';newdiv.style.position='absolute';newdiv.style.top=ipsclass.get_obj_toppos(drag_root_obj)+'px';newdiv.style.left=ipsclass.get_obj_leftpos(drag_root_obj)+'px';newdiv.style.width=drag_orig_obj.offsetWidth+'px';newdiv.style.height=drag_orig_obj.offsetHeight+'px';document.body.appendChild(newdiv);}else{var newdiv=document.getElementById(drag_move.var_original_row_text+'-HIDDEN-'+drag_move.current_id);newdiv.style.display='';}drag_move._drag_in_progress=1;}};dragmove_events.prototype.event_drag_end=function(x,y){if(drag_move.current_id){var drag_main_obj=document.getElementById(drag_move.var_drag_draggable_id_text+'-'+drag_move.current_id);var drag_root_obj=document.getElementById(drag_move.var_drag_object_id_text+'-'+drag_move.current_id);var drag_orig_obj=document.getElementById(drag_move.var_original_row_text+'-'+drag_move.current_id);drag_main_obj.style.display='none';if(document.getElementById(drag_move.var_original_row_text+'-HIDDEN-'+drag_move.current_id)){document.getElementById(drag_move.var_original_row_text+'-HIDDEN-'+drag_move.current_id).style.display='none';}}if(drag_move._TARGETS){for(var i in drag_move._TARGETS){document.body.removeChild(drag_move._TARGETS[i]);}drag_move._TARGETS=new Array();}if(drag_move.var_target_over_id){var new_parent_id=drag_move.var_target_over_id;var page_id=drag_move.current_id;do_request_function=function(){if(!xmlobj.readystate_ready_and_ok()){xmlobj.show_loading("Move in progress...");return;}xmlobj.hide_loading();var returned=xmlobj.xmlhandler.responseText;if(returned.match( /<null>(0|-|\=)<\/null>/)){alert("Error occured, move not completed "+returned);}else{window.location=drag_move.var_bounce_url;}};xmlobj=new ajax_request();xmlobj.onreadystatechange(do_request_function);xmlobj.process(drag_move.var_ajax_url+'&pid='+page_id+'&new_parent_id='+new_parent_id);}drag_move.current_id=null;drag_move._drag_in_progress=null;if(drag_move.var_target_over_id){var target_obj=document.getElementById(drag_move.var_original_row_text+'-'+drag_move.var_target_over_id);target_obj.className=drag_move.var_target_out_classname;}drag_move.var_target_over_id=null;};
